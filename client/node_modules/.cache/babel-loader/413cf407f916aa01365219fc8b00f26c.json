{"ast":null,"code":"import { createSlice } from '@reduxjs/toolkit';\nimport authService from '../../services/auth';\nimport { fetchProjects } from './projectSlice';\nimport storage from '../../utils/localStorage';\nconst initialState = {\n  user: null,\n  loading: false,\n  error: null\n};\nconst authSlice = createSlice({\n  name: 'auth',\n  initialState,\n  reducers: {\n    setUser: (state, action) => {\n      state.user = action.payload;\n      state.loading = false;\n      state.error = null;\n    },\n    logOutUser: (state, action) => {\n      state.user = null;\n    },\n    setAuthLoading: state => {\n      state.loading = true;\n      state.error = null;\n    },\n    setAuthError: (state, action) => {\n      state.loading = false;\n      state.error = action.payload;\n    },\n    clearAuthError: state => {\n      state.error = null;\n    }\n  }\n});\nexport const {\n  setUser,\n  logOutUser\n} = authSlice.actions;\nexport const login = credentials => {\n  return async dispatch => {\n    try {\n      const userData = await authService.login(credentials);\n      dispatch(setUser(userData));\n      storage.saveUser(userData);\n      authService.setToken(userData.token);\n      dispatch(fetchProjects());\n    } catch (err) {\n      console.log(err);\n    }\n  };\n};\nexport const registerUser = credentials => {\n  return async dispatch => {\n    try {\n      const newUser = await authService.register(credentials);\n      dispatch(setUser(newUser));\n      storage.saveUser(newUser);\n      authService.setToken(newUser.token); // const loggedUser = await authService.verify();\n      // if (loggedUser) {\n      //   dispatch(setUser(loggedUser));\n      // }\n\n      dispatch(fetchProjects());\n    } catch (err) {\n      console.log(err);\n    }\n  };\n};\nexport const autoLogin = () => {\n  return async dispatch => {\n    try {\n      const loggedUser = storage.loadUser();\n\n      if (loggedUser) {\n        dispatch(setUser(loggedUser));\n        authService.setToken(loggedUser.token);\n        dispatch(fetchProjects());\n      } // const loggedUser = await authService.verify();\n      // if (loggedUser) {\n      //   dispatch(setUser(loggedUser));\n      // }\n\n    } catch (err) {\n      console.log(err);\n    }\n  };\n};\nexport const logout = () => {\n  return async dispatch => {\n    dispatch(logOutUser);\n    storage.removeUser();\n  };\n};\nexport const selectAuthState = state => state.auth;\nexport default authSlice.reducer;","map":{"version":3,"sources":["C:/Users/david/Desktop/Bug-Tracker-Pern/client/src/redux/slices/authSlice.ts"],"names":["createSlice","authService","fetchProjects","storage","initialState","user","loading","error","authSlice","name","reducers","setUser","state","action","payload","logOutUser","setAuthLoading","setAuthError","clearAuthError","actions","login","credentials","dispatch","userData","saveUser","setToken","token","err","console","log","registerUser","newUser","register","autoLogin","loggedUser","loadUser","logout","removeUser","selectAuthState","auth","reducer"],"mappings":"AAEA,SAASA,WAAT,QAA2C,kBAA3C;AAGA,OAAOC,WAAP,MAAwB,qBAAxB;AAEA,SAASC,aAAT,QAA8B,gBAA9B;AACA,OAAOC,OAAP,MAAoB,0BAApB;AAQA,MAAMC,YAA8B,GAAG;AACrCC,EAAAA,IAAI,EAAE,IAD+B;AAErCC,EAAAA,OAAO,EAAE,KAF4B;AAGrCC,EAAAA,KAAK,EAAE;AAH8B,CAAvC;AAMA,MAAMC,SAAS,GAAGR,WAAW,CAAC;AAC5BS,EAAAA,IAAI,EAAE,MADsB;AAE5BL,EAAAA,YAF4B;AAG5BM,EAAAA,QAAQ,EAAE;AACRC,IAAAA,OAAO,EAAE,CAACC,KAAD,EAAQC,MAAR,KAA6C;AACpDD,MAAAA,KAAK,CAACP,IAAN,GAAaQ,MAAM,CAACC,OAApB;AACAF,MAAAA,KAAK,CAACN,OAAN,GAAgB,KAAhB;AACAM,MAAAA,KAAK,CAACL,KAAN,GAAc,IAAd;AACD,KALO;AAMRQ,IAAAA,UAAU,EAAE,CAACH,KAAD,EAAQC,MAAR,KAAmB;AAC7BD,MAAAA,KAAK,CAACP,IAAN,GAAa,IAAb;AACD,KARO;AASRW,IAAAA,cAAc,EAAGJ,KAAD,IAAW;AACzBA,MAAAA,KAAK,CAACN,OAAN,GAAgB,IAAhB;AACAM,MAAAA,KAAK,CAACL,KAAN,GAAc,IAAd;AACD,KAZO;AAaRU,IAAAA,YAAY,EAAE,CAACL,KAAD,EAAQC,MAAR,KAA0C;AACtDD,MAAAA,KAAK,CAACN,OAAN,GAAgB,KAAhB;AACAM,MAAAA,KAAK,CAACL,KAAN,GAAcM,MAAM,CAACC,OAArB;AACD,KAhBO;AAiBRI,IAAAA,cAAc,EAAGN,KAAD,IAAW;AACzBA,MAAAA,KAAK,CAACL,KAAN,GAAc,IAAd;AACD;AAnBO;AAHkB,CAAD,CAA7B;AA0BA,OAAO,MAAM;AAAEI,EAAAA,OAAF;AAAWI,EAAAA;AAAX,IAA0BP,SAAS,CAACW,OAA1C;AAEP,OAAO,MAAMC,KAAK,GAAIC,WAAD,IAA+C;AAClE,SAAO,MAAOC,QAAP,IAAoB;AACzB,QAAI;AACF,YAAMC,QAAQ,GAAG,MAAMtB,WAAW,CAACmB,KAAZ,CAAkBC,WAAlB,CAAvB;AACAC,MAAAA,QAAQ,CAACX,OAAO,CAACY,QAAD,CAAR,CAAR;AAEApB,MAAAA,OAAO,CAACqB,QAAR,CAAiBD,QAAjB;AACAtB,MAAAA,WAAW,CAACwB,QAAZ,CAAqBF,QAAQ,CAACG,KAA9B;AAEAJ,MAAAA,QAAQ,CAACpB,aAAa,EAAd,CAAR;AACD,KARD,CAQE,OAAOyB,GAAP,EAAY;AACZC,MAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACD;AACF,GAZD;AAaD,CAdM;AAgBP,OAAO,MAAMG,YAAY,GAAIT,WAAD,IAA+C;AACzE,SAAO,MAAOC,QAAP,IAAoB;AACzB,QAAI;AACF,YAAMS,OAAO,GAAG,MAAM9B,WAAW,CAAC+B,QAAZ,CAAqBX,WAArB,CAAtB;AACAC,MAAAA,QAAQ,CAACX,OAAO,CAACoB,OAAD,CAAR,CAAR;AAEA5B,MAAAA,OAAO,CAACqB,QAAR,CAAiBO,OAAjB;AACA9B,MAAAA,WAAW,CAACwB,QAAZ,CAAqBM,OAAO,CAACL,KAA7B,EALE,CAOF;AACA;AACA;AACA;;AACAJ,MAAAA,QAAQ,CAACpB,aAAa,EAAd,CAAR;AACD,KAZD,CAYE,OAAOyB,GAAP,EAAY;AACZC,MAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACD;AACF,GAhBD;AAiBD,CAlBM;AAoBP,OAAO,MAAMM,SAAS,GAAG,MAAgB;AACvC,SAAO,MAAOX,QAAP,IAAoB;AACzB,QAAI;AACF,YAAMY,UAAU,GAAG/B,OAAO,CAACgC,QAAR,EAAnB;;AACA,UAAID,UAAJ,EAAgB;AACdZ,QAAAA,QAAQ,CAACX,OAAO,CAACuB,UAAD,CAAR,CAAR;AACAjC,QAAAA,WAAW,CAACwB,QAAZ,CAAqBS,UAAU,CAACR,KAAhC;AACAJ,QAAAA,QAAQ,CAACpB,aAAa,EAAd,CAAR;AACD,OANC,CAOF;AACA;AACA;AACA;;AACD,KAXD,CAWE,OAAOyB,GAAP,EAAY;AACZC,MAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACD;AACF,GAfD;AAgBD,CAjBM;AAmBP,OAAO,MAAMS,MAAM,GAAG,MAAgB;AACpC,SAAO,MAAOd,QAAP,IAAoB;AACzBA,IAAAA,QAAQ,CAACP,UAAD,CAAR;AACAZ,IAAAA,OAAO,CAACkC,UAAR;AACD,GAHD;AAID,CALM;AAOP,OAAO,MAAMC,eAAe,GAAI1B,KAAD,IAAsBA,KAAK,CAAC2B,IAApD;AAEP,eAAe/B,SAAS,CAACgC,OAAzB","sourcesContent":["import { AppThunk } from './../store';\r\nimport { CredentialsPayload } from './../types';\r\nimport { createSlice, PayloadAction } from '@reduxjs/toolkit';\r\nimport { RootState } from '../store';\r\nimport { UserState } from '../types';\r\nimport authService from '../../services/auth';\r\n\r\nimport { fetchProjects } from './projectSlice';\r\nimport storage from '../../utils/localStorage';\r\n\r\ninterface InitialAuthState {\r\n  user: UserState | null;\r\n  loading: boolean;\r\n  error: string | null;\r\n}\r\n\r\nconst initialState: InitialAuthState = {\r\n  user: null,\r\n  loading: false,\r\n  error: null,\r\n};\r\n\r\nconst authSlice = createSlice({\r\n  name: 'auth',\r\n  initialState,\r\n  reducers: {\r\n    setUser: (state, action: PayloadAction<UserState>) => {\r\n      state.user = action.payload;\r\n      state.loading = false;\r\n      state.error = null;\r\n    },\r\n    logOutUser: (state, action) => {\r\n      state.user = null;\r\n    },\r\n    setAuthLoading: (state) => {\r\n      state.loading = true;\r\n      state.error = null;\r\n    },\r\n    setAuthError: (state, action: PayloadAction<string>) => {\r\n      state.loading = false;\r\n      state.error = action.payload;\r\n    },\r\n    clearAuthError: (state) => {\r\n      state.error = null;\r\n    },\r\n  },\r\n});\r\n\r\nexport const { setUser, logOutUser } = authSlice.actions;\r\n\r\nexport const login = (credentials: CredentialsPayload): AppThunk => {\r\n  return async (dispatch) => {\r\n    try {\r\n      const userData = await authService.login(credentials);\r\n      dispatch(setUser(userData));\r\n\r\n      storage.saveUser(userData);\r\n      authService.setToken(userData.token);\r\n\r\n      dispatch(fetchProjects());\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n};\r\n\r\nexport const registerUser = (credentials: CredentialsPayload): AppThunk => {\r\n  return async (dispatch) => {\r\n    try {\r\n      const newUser = await authService.register(credentials);\r\n      dispatch(setUser(newUser));\r\n\r\n      storage.saveUser(newUser);\r\n      authService.setToken(newUser.token);\r\n\r\n      // const loggedUser = await authService.verify();\r\n      // if (loggedUser) {\r\n      //   dispatch(setUser(loggedUser));\r\n      // }\r\n      dispatch(fetchProjects());\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n};\r\n\r\nexport const autoLogin = (): AppThunk => {\r\n  return async (dispatch) => {\r\n    try {\r\n      const loggedUser = storage.loadUser();\r\n      if (loggedUser) {\r\n        dispatch(setUser(loggedUser));\r\n        authService.setToken(loggedUser.token);\r\n        dispatch(fetchProjects());\r\n      }\r\n      // const loggedUser = await authService.verify();\r\n      // if (loggedUser) {\r\n      //   dispatch(setUser(loggedUser));\r\n      // }\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n};\r\n\r\nexport const logout = (): AppThunk => {\r\n  return async (dispatch) => {\r\n    dispatch(logOutUser);\r\n    storage.removeUser();\r\n  };\r\n};\r\n\r\nexport const selectAuthState = (state: RootState) => state.auth;\r\n\r\nexport default authSlice.reducer;\r\n"]},"metadata":{},"sourceType":"module"}