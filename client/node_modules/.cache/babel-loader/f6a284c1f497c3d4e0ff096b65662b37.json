{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/david/Desktop/Bug-Tracker-Pern/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/david/Desktop/Bug-Tracker-Pern/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{createSlice}from'@reduxjs/toolkit';import authService from'../../services/auth';import{fetchProjects}from'./projectSlice';var initialState={user:null};var authSlice=createSlice({name:'auth',initialState:initialState,reducers:{setUser:function setUser(state,action){state.user=action.payload;},logOutUser:function logOutUser(state,action){state.user=null;}}});var _authSlice$actions=authSlice.actions,setUser=_authSlice$actions.setUser,logOutUser=_authSlice$actions.logOutUser;export{setUser,logOutUser};export var login=function login(credentials){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var userData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return authService.login(credentials);case 3:userData=_context.sent;dispatch(setUser(userData));dispatch(fetchProjects());_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);}));return function(_x){return _ref.apply(this,arguments);};}();};export var registerUser=function registerUser(credentials){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){var newUser,loggedUser;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return authService.register(credentials);case 3:newUser=_context2.sent;dispatch(setUser(newUser));_context2.next=7;return authService.verify();case 7:loggedUser=_context2.sent;if(loggedUser){dispatch(setUser(loggedUser));}dispatch(fetchProjects());_context2.next=15;break;case 12:_context2.prev=12;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 15:case\"end\":return _context2.stop();}}},_callee2,null,[[0,12]]);}));return function(_x2){return _ref2.apply(this,arguments);};}();};export var autoLogin=function autoLogin(){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){var loggedUser;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return authService.verify();case 3:loggedUser=_context3.sent;if(loggedUser){dispatch(setUser(loggedUser));}dispatch(fetchProjects());_context3.next=11;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0);case 11:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8]]);}));return function(_x3){return _ref3.apply(this,arguments);};}();};export var logout=function logout(){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return authService.logout();case 2:dispatch(logOutUser);case 3:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x4){return _ref4.apply(this,arguments);};}();};export var selectAuthState=function selectAuthState(state){return state.auth;};export default authSlice.reducer;","map":{"version":3,"sources":["C:/Users/david/Desktop/Bug-Tracker-Pern/client/src/redux/slices/authSlice.ts"],"names":["createSlice","authService","fetchProjects","initialState","user","authSlice","name","reducers","setUser","state","action","payload","logOutUser","actions","login","credentials","dispatch","userData","console","log","registerUser","register","newUser","verify","loggedUser","autoLogin","logout","selectAuthState","auth","reducer"],"mappings":"uUAEA,OAASA,WAAT,KAA2C,kBAA3C,CAGA,MAAOC,CAAAA,WAAP,KAAwB,qBAAxB,CAEA,OAASC,aAAT,KAA8B,gBAA9B,CAMA,GAAMC,CAAAA,YAA8B,CAAG,CACrCC,IAAI,CAAE,IAD+B,CAAvC,CAIA,GAAMC,CAAAA,SAAS,CAAGL,WAAW,CAAC,CAC5BM,IAAI,CAAE,MADsB,CAE5BH,YAAY,CAAZA,YAF4B,CAG5BI,QAAQ,CAAE,CACRC,OAAO,CAAE,iBAACC,KAAD,CAAQC,MAAR,CAA6C,CACpDD,KAAK,CAACL,IAAN,CAAaM,MAAM,CAACC,OAApB,CACD,CAHO,CAIRC,UAAU,CAAE,oBAACH,KAAD,CAAQC,MAAR,CAAmB,CAC7BD,KAAK,CAACL,IAAN,CAAa,IAAb,CACD,CANO,CAHkB,CAAD,CAA7B,CAaO,uBAAgCC,SAAS,CAACQ,OAA1C,CAAQL,OAAR,oBAAQA,OAAR,CAAiBI,UAAjB,oBAAiBA,UAAjB,C,2BAEP,MAAO,IAAME,CAAAA,KAAK,CAAG,QAARA,CAAAA,KAAQ,CAACC,WAAD,CAA+C,CAClE,+FAAO,iBAAOC,QAAP,qKAEoBf,CAAAA,WAAW,CAACa,KAAZ,CAAkBC,WAAlB,CAFpB,QAEGE,QAFH,eAGHD,QAAQ,CAACR,OAAO,CAACS,QAAD,CAAR,CAAR,CAEAD,QAAQ,CAACd,aAAa,EAAd,CAAR,CALG,+EAOHgB,OAAO,CAACC,GAAR,cAPG,oEAAP,+DAUD,CAXM,CAaP,MAAO,IAAMC,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAACL,WAAD,CAA+C,CACzE,gGAAO,kBAAOC,QAAP,qLAEmBf,CAAAA,WAAW,CAACoB,QAAZ,CAAqBN,WAArB,CAFnB,QAEGO,OAFH,gBAGHN,QAAQ,CAACR,OAAO,CAACc,OAAD,CAAR,CAAR,CAHG,uBAKsBrB,CAAAA,WAAW,CAACsB,MAAZ,EALtB,QAKGC,UALH,gBAMH,GAAIA,UAAJ,CAAgB,CACdR,QAAQ,CAACR,OAAO,CAACgB,UAAD,CAAR,CAAR,CACD,CACDR,QAAQ,CAACd,aAAa,EAAd,CAAR,CATG,qFAWHgB,OAAO,CAACC,GAAR,eAXG,uEAAP,iEAcD,CAfM,CAiBP,MAAO,IAAMM,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,EAAgB,CACvC,gGAAO,kBAAOT,QAAP,6KAEsBf,CAAAA,WAAW,CAACsB,MAAZ,EAFtB,QAEGC,UAFH,gBAGH,GAAIA,UAAJ,CAAgB,CACdR,QAAQ,CAACR,OAAO,CAACgB,UAAD,CAAR,CAAR,CACD,CAEDR,QAAQ,CAACd,aAAa,EAAd,CAAR,CAPG,mFASHgB,OAAO,CAACC,GAAR,eATG,sEAAP,iEAYD,CAbM,CAeP,MAAO,IAAMO,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,EAAgB,CACpC,gGAAO,kBAAOV,QAAP,6IACCf,CAAAA,WAAW,CAACyB,MAAZ,EADD,QAELV,QAAQ,CAACJ,UAAD,CAAR,CAFK,wDAAP,iEAID,CALM,CAOP,MAAO,IAAMe,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAAClB,KAAD,QAAsBA,CAAAA,KAAK,CAACmB,IAA5B,EAAxB,CAEP,cAAevB,CAAAA,SAAS,CAACwB,OAAzB","sourcesContent":["import { AppThunk } from './../store';\r\nimport { CredentialsPayload } from './../types';\r\nimport { createSlice, PayloadAction } from '@reduxjs/toolkit';\r\nimport { RootState } from '../store';\r\nimport { UserState } from '../types';\r\nimport authService from '../../services/auth';\r\n\r\nimport { fetchProjects } from './projectSlice';\r\n\r\ninterface InitialAuthState {\r\n  user: UserState | null;\r\n}\r\n\r\nconst initialState: InitialAuthState = {\r\n  user: null,\r\n};\r\n\r\nconst authSlice = createSlice({\r\n  name: 'auth',\r\n  initialState,\r\n  reducers: {\r\n    setUser: (state, action: PayloadAction<UserState>) => {\r\n      state.user = action.payload;\r\n    },\r\n    logOutUser: (state, action) => {\r\n      state.user = null;\r\n    },\r\n  },\r\n});\r\n\r\nexport const { setUser, logOutUser } = authSlice.actions;\r\n\r\nexport const login = (credentials: CredentialsPayload): AppThunk => {\r\n  return async (dispatch) => {\r\n    try {\r\n      const userData = await authService.login(credentials);\r\n      dispatch(setUser(userData));\r\n\r\n      dispatch(fetchProjects());\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n};\r\n\r\nexport const registerUser = (credentials: CredentialsPayload): AppThunk => {\r\n  return async (dispatch) => {\r\n    try {\r\n      const newUser = await authService.register(credentials);\r\n      dispatch(setUser(newUser));\r\n\r\n      const loggedUser = await authService.verify();\r\n      if (loggedUser) {\r\n        dispatch(setUser(loggedUser));\r\n      }\r\n      dispatch(fetchProjects());\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n};\r\n\r\nexport const autoLogin = (): AppThunk => {\r\n  return async (dispatch) => {\r\n    try {\r\n      const loggedUser = await authService.verify();\r\n      if (loggedUser) {\r\n        dispatch(setUser(loggedUser));\r\n      }\r\n\r\n      dispatch(fetchProjects());\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n};\r\n\r\nexport const logout = (): AppThunk => {\r\n  return async (dispatch) => {\r\n    await authService.logout();\r\n    dispatch(logOutUser);\r\n  };\r\n};\r\n\r\nexport const selectAuthState = (state: RootState) => state.auth;\r\n\r\nexport default authSlice.reducer;\r\n"]},"metadata":{},"sourceType":"module"}