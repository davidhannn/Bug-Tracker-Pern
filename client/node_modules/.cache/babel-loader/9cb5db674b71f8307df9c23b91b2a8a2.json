{"ast":null,"code":"import { createSlice } from '@reduxjs/toolkit';\nimport authService from '../../services/auth';\nimport { fetchProjects } from './projectSlice';\nimport storage from '../../utils/localStorage';\nimport { getErrorMsg } from './../../utils/helper';\nconst initialState = {\n  user: null,\n  loading: false,\n  error: null\n};\nconst authSlice = createSlice({\n  name: 'auth',\n  initialState,\n  reducers: {\n    setUser: (state, action) => {\n      state.user = action.payload;\n      state.loading = false;\n      state.error = null;\n    },\n    logOutUser: (state, action) => {\n      state.user = null;\n    },\n    setAuthLoading: state => {\n      state.loading = true;\n      state.error = null;\n    },\n    setAuthError: (state, action) => {\n      state.loading = false;\n      state.error = action.payload;\n    },\n    clearAuthError: state => {\n      state.error = null;\n    }\n  }\n});\nexport const {\n  setUser,\n  logOutUser,\n  setAuthError,\n  clearAuthError\n} = authSlice.actions;\nexport const login = (credentials, history) => {\n  return async dispatch => {\n    try {\n      const userData = await authService.login(credentials);\n      dispatch(setUser(userData));\n      storage.saveUser(userData);\n      authService.setToken(userData.token);\n      history.push('/');\n      dispatch(fetchProjects());\n    } catch (e) {\n      dispatch(setAuthError(getErrorMsg(e)));\n    }\n  };\n};\nexport const registerUser = (credentials, history) => {\n  return async dispatch => {\n    try {\n      const newUser = await authService.register(credentials);\n      dispatch(setUser(newUser));\n      storage.saveUser(newUser);\n      authService.setToken(newUser.token);\n      history.push('/');\n      dispatch(fetchProjects());\n    } catch (e) {\n      dispatch(setAuthError(getErrorMsg(e)));\n    }\n  };\n};\nexport const autoLogin = () => {\n  return async dispatch => {\n    try {\n      const loggedUser = storage.loadUser();\n\n      if (loggedUser) {\n        dispatch(setUser(loggedUser));\n        authService.setToken(loggedUser.token);\n        dispatch(fetchProjects());\n      }\n    } catch (err) {\n      console.log(err);\n    }\n  };\n};\nexport const logout = () => {\n  return async dispatch => {\n    dispatch(logOutUser);\n    storage.removeUser();\n  };\n};\nexport const selectAuthState = state => state.auth;\nexport default authSlice.reducer;","map":{"version":3,"sources":["C:/Users/david/Desktop/Bug-Tracker-Pern/client/src/redux/slices/authSlice.ts"],"names":["createSlice","authService","fetchProjects","storage","getErrorMsg","initialState","user","loading","error","authSlice","name","reducers","setUser","state","action","payload","logOutUser","setAuthLoading","setAuthError","clearAuthError","actions","login","credentials","history","dispatch","userData","saveUser","setToken","token","push","e","registerUser","newUser","register","autoLogin","loggedUser","loadUser","err","console","log","logout","removeUser","selectAuthState","auth","reducer"],"mappings":"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","sourcesContent":["import { AppThunk } from './../store';\r\nimport { CredentialsPayload } from './../types';\r\nimport { createSlice, PayloadAction } from '@reduxjs/toolkit';\r\nimport { RootState } from '../store';\r\nimport { UserState } from '../types';\r\nimport authService from '../../services/auth';\r\nimport { History } from 'history';\r\n\r\nimport { fetchProjects } from './projectSlice';\r\nimport storage from '../../utils/localStorage';\r\nimport { getErrorMsg } from './../../utils/helper';\r\n\r\ninterface InitialAuthState {\r\n  user: UserState | null;\r\n  loading: boolean;\r\n  error: string | null;\r\n}\r\n\r\nconst initialState: InitialAuthState = {\r\n  user: null,\r\n  loading: false,\r\n  error: null,\r\n};\r\n\r\nconst authSlice = createSlice({\r\n  name: 'auth',\r\n  initialState,\r\n  reducers: {\r\n    setUser: (state, action: PayloadAction<UserState>) => {\r\n      state.user = action.payload;\r\n      state.loading = false;\r\n      state.error = null;\r\n    },\r\n    logOutUser: (state, action) => {\r\n      state.user = null;\r\n    },\r\n    setAuthLoading: (state) => {\r\n      state.loading = true;\r\n      state.error = null;\r\n    },\r\n    setAuthError: (state, action: PayloadAction<string>) => {\r\n      state.loading = false;\r\n      state.error = action.payload;\r\n    },\r\n    clearAuthError: (state) => {\r\n      state.error = null;\r\n    },\r\n  },\r\n});\r\n\r\nexport const { setUser, logOutUser, setAuthError, clearAuthError } =\r\n  authSlice.actions;\r\n\r\nexport const login = (\r\n  credentials: CredentialsPayload,\r\n  history: History\r\n): AppThunk => {\r\n  return async (dispatch) => {\r\n    try {\r\n      const userData = await authService.login(credentials);\r\n      dispatch(setUser(userData));\r\n\r\n      storage.saveUser(userData);\r\n      authService.setToken(userData.token);\r\n      history.push('/');\r\n      dispatch(fetchProjects());\r\n    } catch (e) {\r\n      dispatch(setAuthError(getErrorMsg(e)));\r\n    }\r\n  };\r\n};\r\n\r\nexport const registerUser = (\r\n  credentials: CredentialsPayload,\r\n  history: History\r\n): AppThunk => {\r\n  return async (dispatch) => {\r\n    try {\r\n      const newUser = await authService.register(credentials);\r\n      dispatch(setUser(newUser));\r\n\r\n      storage.saveUser(newUser);\r\n      authService.setToken(newUser.token);\r\n      history.push('/');\r\n      dispatch(fetchProjects());\r\n    } catch (e) {\r\n      dispatch(setAuthError(getErrorMsg(e)));\r\n    }\r\n  };\r\n};\r\n\r\nexport const autoLogin = (): AppThunk => {\r\n  return async (dispatch) => {\r\n    try {\r\n      const loggedUser = storage.loadUser();\r\n      if (loggedUser) {\r\n        dispatch(setUser(loggedUser));\r\n        authService.setToken(loggedUser.token);\r\n        dispatch(fetchProjects());\r\n      }\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n};\r\n\r\nexport const logout = (): AppThunk => {\r\n  return async (dispatch) => {\r\n    dispatch(logOutUser);\r\n    storage.removeUser();\r\n  };\r\n};\r\n\r\nexport const selectAuthState = (state: RootState) => state.auth;\r\n\r\nexport default authSlice.reducer;\r\n"]},"metadata":{},"sourceType":"module"}